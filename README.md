# API de Agendamento M√©dico

API desenvolvida em **Node.js** com **TypeScript**, **Serverless Framework** e **AWS Lambda** para gerenciamento de agendamentos m√©dicos.
Objectivo realizar teste tecnico para vaga DESENVOLVEDOR DE BACK END PLENO da empresa **Leve Sa√∫de**.
requisitos: `https://succinct-tadpole-fde.notion.site/Teste-T-cnico-13ee9214de4e479b8f6e87752a358078`

## üöÄ Tecnologias Utilizadas

- **Node.js** (v18+)
- **TypeScript**
- **Serverless Framework**
- **AWS Lambda**
- **AWS API Gateway**
- **Jest** (Testes)
- **Joi** (Valida√ß√£o)
- **ESLint** + **Prettier** (Qualidade de c√≥digo)

## üìã Pr√©-requisitos

- Node.js v18 ou superior
- npm ou yarn
- AWS CLI configurado (para deploy)
- Serverless Framework CLI

## üõ†Ô∏è Instala√ß√£o

1. **Clone o reposit√≥rio**
```bash
git clone <url-do-repositorio>
cd api-agendamento-medico
```

2. **Instale as depend√™ncias**
```bash
npm install
```

3. **Configure o AWS CLI** (opcional, apenas para deploy)
```bash
aws configure
```

## üèÉ‚Äç‚ôÇÔ∏è Como Executar

### Desenvolvimento Local

Para executar a API localmente usando o serverless-offline:

```bash
npm run dev
```

A API estar√° dispon√≠vel em: `http://localhost:3000`

### Testes

```bash
# Executar todos os testes
npm test

# Executar testes em modo watch
npm run test:watch

# Executar testes com cobertura
npm run test:coverage
```

### Qualidade de C√≥digo

```bash
# Verificar linting
npm run lint

# Corrigir problemas de linting automaticamente
npm run lint:fix

# Formatar c√≥digo
npm run format
```

### Build

```bash
npm run build
```

### Deploy

```bash
# Deploy para ambiente de desenvolvimento
npm run deploy

# Deploy para produ√ß√£o
npm run deploy:prod
```

## üìö Documenta√ß√£o da API

### Collection Postman

Para facilitar os testes da API, foi criada uma collection completa do Postman com todos os endpoints e exemplos de sucesso e falha.

**üîó Collection P√∫blica:**
- [API Agendamento M√©dico - Collection Postman](https://www.postman.com/gold-crater-405622/teste-tecnico/collection/gfonp7z/api-agendamento-mdico)

**üìÅ Arquivos dispon√≠veis:**
- `postman_collection.json` - Collection para importar no Postman
- `POSTMAN_COLLECTION_README.md` - Guia completo de uso da collection

**üöÄ Como usar:**
1. **Op√ß√£o 1**: Clique no link p√∫blico acima e importe diretamente
2. **Op√ß√£o 2**: Importe o arquivo `postman_collection.json` no Postman
3. Configure as vari√°veis de ambiente (`baseUrl`, `awsUrl`)
4. Teste todos os cen√°rios incluindo sucesso e falha

### Base URL
- **Local**: `http://localhost:3000`
- **AWS**: `https://[api-id].execute-api.[region].amazonaws.com/dev`

### Endpoints

#### 1. Buscar Agendas e Hor√°rios dos M√©dicos

**GET** `/agendas`

Retorna uma lista de m√©dicos com suas respectivas agendas e hor√°rios dispon√≠veis, agrupados por m√©dico.

**Query Parameters:**
- `medico` (opcional): Nome do m√©dico para filtrar
- `data` (opcional): Data espec√≠fica no formato YYYY-MM-DD

**Exemplo de Requisi√ß√£o:**
```bash
curl -X GET "http://localhost:3000/agendas?medico=Dr. Jo√£o Silva&data=2024-10-05"
```

**Exemplo de Resposta:**
```json
{
  "success": true,
  "data": {
    "medicos": [
      {
        "id": "1",
        "nome": "Dr. Jo√£o Silva",
        "especialidade": "Cardiologia",
        "horarios_disponiveis": [
          "2024-10-05 09:00",
          "2024-10-05 10:00",
          "2024-10-05 11:00"
        ]
      },
      {
        "id": "2",
        "nome": "Dra. Maria Santos",
        "especialidade": "Dermatologia",
        "horarios_disponiveis": [
          "2024-10-06 14:00",
          "2024-10-06 15:00"
        ]
      }
    ]
  },
  "message": "Agendas encontradas com sucesso"
}
```

**Resposta sem filtros (todos os m√©dicos):**
```json
{
  "success": true,
  "data": {
    "medicos": [
      {
        "id": "1",
        "nome": "Dr. Jo√£o Silva",
        "especialidade": "Cardiologia",
        "horarios_disponiveis": [
          "2024-10-05 09:00",
          "2024-10-05 10:00",
          "2024-10-05 11:00",
          "2024-10-06 09:00"
        ]
      },
      {
        "id": "2",
        "nome": "Dra. Maria Santos",
        "especialidade": "Dermatologia",
        "horarios_disponiveis": [
          "2024-10-05 14:00",
          "2024-10-05 15:00",
          "2024-10-06 14:00",
          "2024-10-06 15:00"
        ]
      },
      {
        "id": "3",
        "nome": "Dr. Carlos Oliveira",
        "especialidade": "Ortopedia",
        "horarios_disponiveis": [
          "2024-10-05 16:00",
          "2024-10-05 17:00"
        ]
      }
    ]
  },
  "message": "Agendas encontradas com sucesso"
}
```

### Formato de Retorno - GET /agendas

O endpoint `/agendas` foi atualizado para retornar os dados agrupados por m√©dico, facilitando a visualiza√ß√£o dos hor√°rios dispon√≠veis:

**Estrutura da Resposta:**
- `medicos`: Array de m√©dicos com seus hor√°rios dispon√≠veis
- Cada m√©dico cont√©m:
  - `id`: Identificador √∫nico do m√©dico
  - `nome`: Nome completo do m√©dico
  - `especialidade`: Especialidade m√©dica
  - `horarios_disponiveis`: Array de hor√°rios no formato "YYYY-MM-DD HH:MM"


#### 2. Marcar Agendamento do Paciente

**POST** `/agendamento`

Permite que o paciente marque um hor√°rio de consulta com um m√©dico.

**Body da Requisi√ß√£o:**
```json
{
  "agendamento": {
    "medico": "Dr. Jo√£o Silva",
    "paciente": "Carlos Almeida",
    "data_horario": "2024-10-05 09:00"
  }
}
```

**Exemplo de Requisi√ß√£o:**
```bash
curl -X POST "http://localhost:3000/agendamento" \
  -H "Content-Type: application/json" \
  -d '{
    "agendamento": {
      "medico": "Dr. Jo√£o Silva",
      "paciente": "Carlos Almeida",
      "data_horario": "2024-10-05 09:00"
    }
  }'
```

**Exemplo de Resposta:**
```json
{
  "success": true,
  "data": {
    "mensagem": "Agendamento realizado com sucesso",
    "agendamento": {
      "medico": "Dr. Jo√£o Silva",
      "paciente": "Carlos Almeida",
      "data_horario": "2024-10-05 09:00"
    }
  },
  "message": "Agendamento criado com sucesso"
}
```

### C√≥digos de Status HTTP

- **200**: Sucesso
- **201**: Criado com sucesso
- **400**: Requisi√ß√£o inv√°lida
- **404**: Recurso n√£o encontrado
- **500**: Erro interno do servidor

## üèóÔ∏è Estrutura do Projeto

```
src/
‚îú‚îÄ‚îÄ agenda/                    # Dom√≠nio de agenda
‚îÇ   ‚îú‚îÄ‚îÄ controller/           # Controllers
‚îÇ   ‚îú‚îÄ‚îÄ service/             # L√≥gica de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ interfaces/          # Interfaces
‚îÇ   ‚îî‚îÄ‚îÄ mocks/              # Dados mockados
‚îú‚îÄ‚îÄ agendamento/             # Dom√≠nio de agendamento
‚îÇ   ‚îú‚îÄ‚îÄ controller/          # Controllers
‚îÇ   ‚îú‚îÄ‚îÄ service/            # L√≥gica de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ interfaces/          # Interfaces
‚îÇ   ‚îî‚îÄ‚îÄ mocks/             # Dados mockados
‚îú‚îÄ‚îÄ handlers/               # Handlers das fun√ß√µes Lambda
‚îú‚îÄ‚îÄ types/                  # Tipos TypeScript
‚îÇ   ‚îî‚îÄ‚îÄ index.ts           # Interfaces e tipos (Medico, Agenda, Agendamento, etc.)
‚îú‚îÄ‚îÄ utils/                  # Utilit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ response.ts        # Padroniza√ß√£o de respostas
‚îÇ   ‚îî‚îÄ‚îÄ validation.ts      # Valida√ß√µes
‚îî‚îÄ‚îÄ __tests__/             # Testes
```

### Principais Tipos

- **Medico**: Informa√ß√µes do m√©dico (id, nome, especialidade, crm)
- **Agenda**: Agenda de um m√©dico em uma data espec√≠fica
- **Agendamento**: Agendamento de consulta completo (com id, status, data_criacao)
- **AgendamentoSimplificado**: Agendamento simplificado (apenas medico, paciente, data_horario)
- **MedicoComHorarios**: M√©dico com lista de hor√°rios dispon√≠veis
- **AgendasResponse**: Resposta do endpoint GET /agendas
- **AgendamentoResponse**: Resposta do endpoint POST /agendamento

## üß™ Testes

O projeto inclui testes unit√°rios abrangentes para:

- **AgendaService**: Testes da l√≥gica de neg√≥cio de agendas
  - `buscarAgendas()`: Busca tradicional de agendas
  - `buscarAgendasFormatadas()`: Novo m√©todo que retorna dados agrupados por m√©dico
  - `buscarAgendaPorId()`: Busca de agenda espec√≠fica
  - `verificarDisponibilidade()`: Verifica√ß√£o de disponibilidade de hor√°rio
- **AgendamentoService**: Testes da l√≥gica de neg√≥cio de agendamentos
- **AgendamentoController**: Testes do controller de agendamentos
  - Formato de resposta simplificado
  - Valida√ß√£o de entrada
- **ValidationUtil**: Testes das valida√ß√µes de dados

### Executar Testes

```bash
# Todos os testes
npm test

# Testes com cobertura
npm run test:coverage

# Testes em modo watch
npm run test:watch
```

## üîß Configura√ß√µes

### TypeScript
- Configurado com strict mode
- Target: ES2020
- M√≥dulo: CommonJS

### ESLint
- Regras para TypeScript
- Configura√ß√µes para boas pr√°ticas

### Prettier
- Formata√ß√£o consistente
- Configura√ß√µes para legibilidade

### Jest
- Configurado para TypeScript
- Cobertura de c√≥digo
- Setup autom√°tico

## üöÄ Deploy

### Pr√©-requisitos para Deploy

1. **AWS CLI configurado**
2. **Credenciais AWS v√°lidas**
3. **Serverless Framework instalado globalmente**

```bash
npm install -g serverless
```

### Deploy para AWS

```bash
# Deploy para desenvolvimento
npm run deploy

# Deploy para produ√ß√£o
npm run deploy:prod
```

### Vari√°veis de Ambiente

O projeto utiliza as seguintes vari√°veis de ambiente:

- `NODE_ENV`: Ambiente de execu√ß√£o (dev, prod)
- `AWS_REGION`: Regi√£o AWS (padr√£o: us-east-1)

## üìù Valida√ß√µes

### Agendamento
- **M√©dico**: Obrigat√≥rio, m√≠nimo 3 caracteres
- **Paciente**: Obrigat√≥rio, m√≠nimo 3 caracteres
- **Data/Hora**: Obrigat√≥rio, formato YYYY-MM-DD HH:MM, deve ser futura

### Agenda Query
- **M√©dico**: Opcional, m√≠nimo 3 caracteres
- **Data**: Opcional, formato YYYY-MM-DD

## üîí Seguran√ßa

- Valida√ß√£o de entrada em todos os endpoints
- Sanitiza√ß√£o de dados
- Headers CORS configurados
- Tratamento de erros padronizado

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üë®‚Äçüíª Autor

Desenvolvedor - Renato Carvalho